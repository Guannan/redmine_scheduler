<%= render 'nav/nav' %>
<h2>Your Bookings</h2>
<%= render 'search_form' %>

<!--On orphaned bookings-->
<div>
  <table class = "list issue">
    <h3>Your Orphaned Bookings</h3>
    <th>Patron Name</th>
    <th>Coach</th>
    <th>Start Time</th>
    <th>End Time</th>
    
    <% @orph_bookings.each do |booking| %>
      <tr>
        <td><%= booking.name %></td>
        <td><%= booking.coach %></td>
        <td><%= booking.timeslots.sort_by(&:slot_time).first.start_time.strftime("%H:%M:%S") %></td>
        <td><%= booking.timeslots.sort_by(&:slot_time).last.end_time.strftime("%H:%M:%S") %></td>
      </tr>
    <% end %>
  </table>
</div>

<!--On active bookings-->
<div>
  <table class = "list issue">
    <h3>Your Active Bookings</h3>
    <th><%= link_to 'Patron Name', {:action => 'index'} %></th>
    <th>Coach</th>
    <th>Start Time</th>
    <th>End Time</th>
    
    <% @act_bookings.each do |booking| %>
      <tr>
        <td><%= booking.name %></td>
        <td><%= booking.coach %></td>
        <td><%= booking.timeslots.sort_by(&:slot_time).first.start_time.strftime("%H:%M:%S") %></td>
        <td><%= booking.timeslots.sort_by(&:slot_time).last.end_time.strftime("%H:%M:%S") %></td>
      </tr>
    <% end %>
  </table>
</div>
<%= will_paginate @act_bookings, :params=>{:from => {:year => @from.year.to_s, :month => @from.month.to_s, :day => @from.day.to_s}}%>

<!--On cancelled bookings-->
<div>
  <table class = "list issue">
    <h3>Your Cancelled Bookings</h3>
    <th>Patron Name</th>
    <th>Coach</th>
    <th>Start Time</th>
    <th>End Time</th>
    
    <% @canc_bookings.each do |booking| %>
      <tr>
        <td><%= booking.name %></td>
        <td><%= booking.coach %></td>
        <td><%= booking.timeslots.sort_by(&:slot_time).first.start_time.strftime("%H:%M:%S") %></td>
        <td><%= booking.timeslots.sort_by(&:slot_time).last.end_time.strftime("%H:%M:%S") %></td>
      </tr>
    <% end %>
  </table>
</div>

<!--On all bookings-->
<div>
<table class = "list issue">
    <h3>List of all bookings</h3>
    <th>Patron Name</th>
    <th>Coach</th>
    <th>Start Time</th>
    <th>End Time</th>
    
    <% @bookings.each do |booking| %>
   	  <tr>
   	  	<td><%= booking.name %></td>
        <td><%= booking.coach %></td>
		    <td><%= booking.timeslots.sort_by(&:slot_time).first.start_time.strftime("%H:%M:%S") %></td>
        <td><%= booking.timeslots.sort_by(&:slot_time).last.end_time.strftime("%H:%M:%S") %></td>
      </tr>
    <% end %>
</table>
</div>