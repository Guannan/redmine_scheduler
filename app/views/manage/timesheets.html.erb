<%= render 'nav' %>
<h2>Your Timecards</h2>

<% form_tag do %>
<%= select_year Date.new(@year.to_i) %>
<%= select_tag(:tweek, options_for_select(@weeks, @weeks[@tweek.to_i - 1])) %>
<%= submit_tag "Update" %>
<% end %>
<br>

<ul>
	<% count = 0 %>
	<% 7.times do %>
	  <% day = (@weekof + count.days) %>
	  <% ents = @entsbyday[count] %>
	  <li><%= day.strftime("%A - %D") %><!--<%= ents.inject(0) {|sum, x| sum + x.hours} %>--></li>
	  <ul>
		<% ents.each do |ent| %>
		<li>
			<%= (TimeEntryActivity.all.select {|t| t.id == ent.activity_id })[0].name %>
                        <%= ": " %>
			<% if ent.comments != "" %><%= ent.comments %><% else %>no comment<% end %>
			<%= " - " %>
			<%= ent.hours %>
                	<%= link_to image_tag('edit.png'), {:controller => 'timelog', :action => 'edit', :id => ent, :project_id => nil},
			                                       :title => l(:button_edit) %>
			<%= link_to image_tag('delete.png'), {:controller => 'timelog', :action => 'destroy', :id => ent, :project_id => nil},
			                                         :confirm => l(:text_are_you_sure),
			                                         :method => :delete,
			                                         :title => l(:button_delete) %>
	  	</li>
          <% end %>
	  </ul>
	  <% count += 1 %>
	<% end %>
</ul>
<br>
<h3>TOTAL HOURS WORKED: <%= @totalhours %></h3>
</br>
<%= button_to "Generate Timecard", {:controller => 'manage', :action => 'generate_timesheet', :weekof => @weekof} %>
</br>
</br>
<p>Missing a shift?  Take a look here:</p>
<% allshifts = Issue.all.select {|i| i.is_shift?} %>
<% count = 0 %>
<ul>
<% 7.times do %>
	<% day = (@weekof + count.days) %>
	<li><%= day.strftime("%A - %D") %></li>
	<% allshiftstoday = allshifts.select {|i| (i.start_date == day) } %>
	  <ul>
		<% allshiftstoday.each do |shift| %>
			<li><%= shift.tracker.name %> : <%= link_to shift.subject, {:controller => 'issues', :action => 'show', :id => shift[:id]} %> - <%= link_to image_tag('time_add.png'), {:controller => 'timelog', :action => 'new', :issue_id => shift[:id], :time_entry => {:spent_on => shift[:start_date]} } %></li>
		<% end %>
	  </ul>
	<br>
	<% count += 1 %>
<% end %>
</ul>